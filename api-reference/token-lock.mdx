---
title: 'Lock API'
description: '토큰 잠금 및 해제'
---

# Lock API

Lock API는 토큰의 잠금(Lock) 및 해제(Unlock) 기능을 제공합니다. 잠금된 토큰은 전송이 불가능합니다.

## 잠금 용도

<CardGroup cols={2}>
  <Card title="질권 설정" icon="handshake">
    담보 목적의 토큰 잠금
  </Card>
  <Card title="배당/이자 지급" icon="money-bill">
    권리확정일 기준 잠금
  </Card>
  <Card title="락업 기간" icon="clock">
    발행 후 일정 기간 전송 제한
  </Card>
  <Card title="법적 동결" icon="gavel">
    법원 명령에 따른 자산 동결
  </Card>
</CardGroup>

---

## 토큰 잠금

특정 주소의 토큰을 잠금 처리합니다.

### Request

```bash
POST /main/v1/tokens/{token}/lock
```

<ParamField path="token" type="string" required>
  토큰 심볼 (예: `PULSE-ST-001`)
</ParamField>

### Body Parameters

<ParamField body="holder" type="string" required>
  잠금 대상 지갑 주소
</ParamField>

<ParamField body="value" type="string" required>
  잠금 수량
</ParamField>

<ParamField body="partition" type="string">
  파티션 ID (선택)
</ParamField>

<ParamField body="reason" type="string">
  잠금 사유
</ParamField>

<ParamField body="unlockDate" type="string">
  자동 해제 일시 (ISO 8601, 선택)
</ParamField>

### Example

<CodeGroup>

```bash cURL
curl -X POST "https://api.stopulse.co.kr/main/v1/tokens/PULSE-ST-001/lock" \
  -H "Authorization: Bearer {access_token}" \
  -H "Content-Type: application/json" \
  -d '{
    "holder": "0xd14f723e859ec4f3edee57bf78ceb7c81de08dfb",
    "value": "500",
    "reason": "질권설정",
    "unlockDate": "2025-01-15T00:00:00Z"
  }'
```

```javascript JavaScript
const response = await fetch(
  'https://api.stopulse.co.kr/main/v1/tokens/PULSE-ST-001/lock',
  {
    method: 'POST',
    headers: {
      'Authorization': 'Bearer {access_token}',
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      holder: '0xd14f723e859ec4f3edee57bf78ceb7c81de08dfb',
      value: '500',
      reason: '질권설정',
      unlockDate: '2025-01-15T00:00:00Z'
    })
  }
);
```

```python Python
import requests

url = "https://api.stopulse.co.kr/main/v1/tokens/PULSE-ST-001/lock"
headers = {
    "Authorization": "Bearer {access_token}",
    "Content-Type": "application/json"
}
data = {
    "holder": "0xd14f723e859ec4f3edee57bf78ceb7c81de08dfb",
    "value": "500",
    "reason": "질권설정",
    "unlockDate": "2025-01-15T00:00:00Z"
}

response = requests.post(url, headers=headers, json=data)
```

</CodeGroup>

### Response

```json 200
{
  "transactionHash": "0xabc123...",
  "requestId": "lock-123456",
  "lockId": "lock-001",
  "token": "PULSE-ST-001",
  "holder": "0xd14f723e859ec4f3edee57bf78ceb7c81de08dfb",
  "value": "500",
  "reason": "질권설정",
  "unlockDate": "2025-01-15T00:00:00Z",
  "lockedAt": "2024-01-15T10:30:00Z"
}
```

---

## 토큰 잠금 해제

잠금된 토큰을 해제합니다.

### Request

```bash
POST /main/v1/tokens/{token}/unlock
```

### Body Parameters

<ParamField body="lockId" type="string" required>
  잠금 ID
</ParamField>

또는

<ParamField body="holder" type="string" required>
  잠금 해제 대상 지갑 주소
</ParamField>

<ParamField body="value" type="string" required>
  해제 수량
</ParamField>

### Example

```bash cURL
# lockId로 해제
curl -X POST "https://api.stopulse.co.kr/main/v1/tokens/PULSE-ST-001/unlock" \
  -H "Authorization: Bearer {access_token}" \
  -H "Content-Type: application/json" \
  -d '{
    "lockId": "lock-001"
  }'

# holder와 value로 해제
curl -X POST "https://api.stopulse.co.kr/main/v1/tokens/PULSE-ST-001/unlock" \
  -H "Authorization: Bearer {access_token}" \
  -H "Content-Type: application/json" \
  -d '{
    "holder": "0xd14f723e859ec4f3edee57bf78ceb7c81de08dfb",
    "value": "500"
  }'
```

### Response

```json 200
{
  "transactionHash": "0xdef456...",
  "requestId": "unlock-789012",
  "token": "PULSE-ST-001",
  "holder": "0xd14f723e859ec4f3edee57bf78ceb7c81de08dfb",
  "unlockedValue": "500",
  "unlockedAt": "2024-01-20T10:30:00Z"
}
```

---

## 잠금 상태 조회

특정 주소의 토큰 잠금 상태를 조회합니다.

### Request

```bash
GET /main/v1/tokens/{token}/holders/{holder}/locks
```

### Response

```json 200
{
  "token": "PULSE-ST-001",
  "holder": "0xd14f723e859ec4f3edee57bf78ceb7c81de08dfb",
  "totalBalance": "1000",
  "lockedBalance": "500",
  "availableBalance": "500",
  "locks": [
    {
      "lockId": "lock-001",
      "value": "300",
      "reason": "질권설정",
      "unlockDate": "2025-01-15T00:00:00Z",
      "lockedAt": "2024-01-15T10:30:00Z"
    },
    {
      "lockId": "lock-002",
      "value": "200",
      "reason": "락업기간",
      "unlockDate": "2024-07-01T00:00:00Z",
      "lockedAt": "2024-01-01T00:00:00Z"
    }
  ]
}
```

---

## 토큰별 전체 잠금 현황

토큰의 전체 잠금 현황을 조회합니다.

### Request

```bash
GET /main/v1/tokens/{token}/locks
```

### Query Parameters

<ParamField query="status" type="string">
  잠금 상태 필터 (`active` | `released` | `all`)
</ParamField>

### Response

```json 200
{
  "token": "PULSE-ST-001",
  "totalLocked": "10000",
  "activeLocks": 15,
  "locks": [
    {
      "lockId": "lock-001",
      "holder": "0xd14f...",
      "value": "500",
      "reason": "질권설정",
      "status": "active"
    },
    {
      "lockId": "lock-002",
      "holder": "0x734c...",
      "value": "1000",
      "reason": "락업기간",
      "status": "active"
    }
  ]
}
```

---

## 자동 잠금 해제

`unlockDate`가 설정된 잠금은 해당 일시에 자동으로 해제됩니다.

```
┌─────────────┐     unlockDate 도달     ┌─────────────┐
│   Locked    │ ──────────────────────▶ │  Unlocked   │
│   토큰      │      (자동 처리)        │   토큰      │
└─────────────┘                         └─────────────┘
```

<Note>
  자동 해제는 블록체인 트랜잭션 없이 스마트 컨트랙트 레벨에서 처리됩니다.
  `transfer` 시점에 잠금 상태가 확인됩니다.
</Note>

---

## 에러 응답

| HTTP Status | 에러 코드 | 설명 |
|-------------|----------|------|
| 400 | `INSUFFICIENT_BALANCE` | 잠금 수량이 가용 잔액 초과 |
| 400 | `INVALID_LOCK_ID` | 유효하지 않은 잠금 ID |
| 400 | `LOCK_NOT_FOUND` | 잠금 정보를 찾을 수 없음 |
| 400 | `ALREADY_UNLOCKED` | 이미 해제된 잠금 |
| 403 | `NOT_AUTHORIZED` | 잠금/해제 권한 없음 |
| 404 | `TOKEN_NOT_FOUND` | 토큰이 존재하지 않음 |
