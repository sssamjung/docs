---
title: '문제 해결'
description: 'API 에러 및 일반적인 문제 해결 가이드'
---

# 문제 해결 (Troubleshooting)

Pulse API 사용 중 발생할 수 있는 일반적인 문제와 해결 방법을 안내합니다.

---

## HTTP 상태 코드

### 4xx 클라이언트 에러

<AccordionGroup>
  <Accordion title="400 Bad Request">
    **원인**: 요청 형식이 잘못되었습니다.

    **해결 방법**:
    - JSON 형식 확인
    - 필수 파라미터 누락 여부 확인
    - 데이터 타입 확인 (숫자, 문자열 등)

    ```json
    // 잘못된 예시
    { "value": 1000 }  // 문자열이어야 함

    // 올바른 예시
    { "value": "1000" }
    ```
  </Accordion>

  <Accordion title="401 Unauthorized">
    **원인**: 인증 실패

    **해결 방법**:
    - Access Token 유효성 확인
    - Authorization 헤더 형식 확인
    - 토큰 만료 여부 확인

    ```bash
    # 올바른 형식
    Authorization: Bearer {access_token}
    ```
  </Accordion>

  <Accordion title="403 Forbidden">
    **원인**: 권한 없음

    **해결 방법**:
    - 해당 토큰에 대한 운영 권한 확인
    - 요청 주소가 KYC 등록되어 있는지 확인
    - Issuer/Operator 권한 확인

    **일반적인 경우**:
    - 타 발행사의 토큰에 접근 시도
    - KYC 미등록 주소로 전송 시도
  </Accordion>

  <Accordion title="404 Not Found">
    **원인**: 리소스를 찾을 수 없음

    **해결 방법**:
    - 토큰 심볼 확인 (대소문자 구분)
    - 지갑 주소 형식 확인 (0x 포함, 42자)
    - API 엔드포인트 URL 확인

    ```bash
    # 올바른 주소 형식
    0xa13Ff1b6930c25d96baf2165A9f3B83d057D2D73
    ```
  </Accordion>

  <Accordion title="429 Too Many Requests">
    **원인**: Rate Limit 초과

    **해결 방법**:
    - 요청 빈도 줄이기
    - 재시도 로직에 백오프 적용
    - Rate Limit 상향 요청 (운영팀 문의)

    ```javascript
    // 지수 백오프 예시
    async function requestWithBackoff(fn, maxRetries = 3) {
      for (let i = 0; i < maxRetries; i++) {
        try {
          return await fn();
        } catch (error) {
          if (error.status === 429) {
            await sleep(Math.pow(2, i) * 1000);
            continue;
          }
          throw error;
        }
      }
    }
    ```
  </Accordion>
</AccordionGroup>

### 5xx 서버 에러

<AccordionGroup>
  <Accordion title="500 Internal Server Error">
    **원인**: 서버 내부 오류

    **해결 방법**:
    1. 잠시 후 재시도
    2. 요청 내용 검토
    3. 문제 지속 시 운영팀 문의

    ```javascript
    // 재시도 로직 예시
    async function requestWithRetry(fn, maxRetries = 3) {
      for (let i = 0; i < maxRetries; i++) {
        try {
          return await fn();
        } catch (error) {
          if (error.status >= 500 && i < maxRetries - 1) {
            await sleep(1000);
            continue;
          }
          throw error;
        }
      }
    }
    ```
  </Accordion>

  <Accordion title="503 Service Unavailable">
    **원인**: 서비스 일시 중단

    **해결 방법**:
    - 정기 점검 시간 확인
    - 상태 페이지 확인
    - 자동 재시도 로직 적용
  </Accordion>
</AccordionGroup>

---

## 비즈니스 에러 코드

### 토큰 관련 에러

| 에러 코드 | 메시지 | 해결 방법 |
|----------|--------|----------|
| `TOKEN_NOT_FOUND` | 토큰을 찾을 수 없음 | 토큰 심볼 확인 |
| `TOKEN_NOT_ISSUABLE` | 추가 발행 불가 | finishIssuance 호출 여부 확인 |
| `INSUFFICIENT_BALANCE` | 잔액 부족 | 보유 잔액 확인 |
| `INVALID_PARTITION` | 잘못된 파티션 | 파티션 ID 확인 |

### KYC 관련 에러

| 에러 코드 | 메시지 | 해결 방법 |
|----------|--------|----------|
| `KYC_NOT_REGISTERED` | KYC 미등록 | 수신자 KYC 등록 필요 |
| `KYC_ALREADY_REGISTERED` | 이미 KYC 등록됨 | 중복 등록 요청 무시 |
| `INVALID_ADDRESS` | 잘못된 주소 형식 | 주소 형식 확인 (0x...) |

### Swap 관련 에러

| 에러 코드 | 메시지 | 해결 방법 |
|----------|--------|----------|
| `SWAP_NOT_ALLOWED` | Swap 불가 | KYC 상태, 잔액 확인 |
| `ST_INSUFFICIENT` | ST 잔액 부족 | 매도자 ST 잔액 확인 |
| `DT_INSUFFICIENT` | DT 잔액 부족 | 매수자 DT 잔액 확인 |

---

## 일반적인 문제

### 트랜잭션이 처리되지 않음

<Steps>
  <Step title="트랜잭션 상태 확인">
    ```bash
    GET /transactions/{transactionHash}/status
    ```
    - `PENDING`: 처리 중
    - `SUCCESS`: 완료
    - `FAILED`: 실패
  </Step>
  <Step title="Nonce 충돌 확인">
    동일 주소에서 동시에 여러 트랜잭션 전송 시 Nonce 충돌이 발생할 수 있습니다.
    순차적으로 트랜잭션을 전송하거나, Kafka를 통한 비동기 처리를 권장합니다.
  </Step>
  <Step title="네트워크 상태 확인">
    Block Explorer에서 네트워크 상태를 확인하세요.
    [Block Explorer 바로가기](/appendix/block-explorer)
  </Step>
</Steps>

### 잔액 조회 결과가 예상과 다름

<AccordionGroup>
  <Accordion title="파티션별 잔액 확인">
    토큰이 여러 파티션에 분산되어 있을 수 있습니다:

    ```bash
    # 전체 잔액
    GET /holders/{token}/{address}/balance

    # 파티션별 잔액
    GET /holders/{token}/{address}/partitions
    ```
  </Accordion>

  <Accordion title="트랜잭션 확정 대기">
    트랜잭션이 아직 확정되지 않았을 수 있습니다. QBFT 합의는 즉각적이지만, 시스템 처리에 약간의 지연이 있을 수 있습니다.
  </Accordion>
</AccordionGroup>

### Kafka 이벤트가 수신되지 않음

<AccordionGroup>
  <Accordion title="Consumer Group 확인">
    - Consumer Group ID가 올바른지 확인
    - 동일 Group ID를 사용하는 다른 Consumer가 있는지 확인
    - Offset 설정 확인 (`earliest` vs `latest`)
  </Accordion>

  <Accordion title="Topic 구독 확인">
    ```javascript
    // 올바른 토픽 구독
    await consumer.subscribe({
      topic: 'pulse.transactions',
      fromBeginning: false  // 새 이벤트부터 수신
    });
    ```
  </Accordion>

  <Accordion title="네트워크 연결 확인">
    - Kafka 브로커 연결 상태 확인
    - 방화벽 설정 확인
    - SSL/TLS 인증서 유효성 확인
  </Accordion>
</AccordionGroup>

---

## 디버깅 팁

### API 요청 로깅

```javascript
// Axios 인터셉터를 사용한 로깅
axios.interceptors.request.use(request => {
  console.log('Request:', {
    method: request.method,
    url: request.url,
    data: request.data
  });
  return request;
});

axios.interceptors.response.use(
  response => {
    console.log('Response:', response.data);
    return response;
  },
  error => {
    console.error('Error:', {
      status: error.response?.status,
      data: error.response?.data
    });
    return Promise.reject(error);
  }
);
```

### 트랜잭션 추적

```javascript
// 트랜잭션 상태 폴링
async function waitForTransaction(txHash, timeout = 30000) {
  const startTime = Date.now();

  while (Date.now() - startTime < timeout) {
    const response = await fetch(
      `https://api.stopulse.co.kr/main/v1/transactions/${txHash}/status`,
      { headers: { 'Authorization': `Bearer ${token}` } }
    );

    const { status } = await response.json();

    if (status === 'SUCCESS') return true;
    if (status === 'FAILED') throw new Error('Transaction failed');

    await sleep(1000);
  }

  throw new Error('Transaction timeout');
}
```

---

## 지원 요청

문제가 해결되지 않는 경우 다음 정보와 함께 문의해 주세요:

<CardGroup cols={2}>
  <Card title="필수 정보" icon="list-check">
    - 요청 시간 (KST)
    - API 엔드포인트
    - 요청 파라미터
    - 에러 응답 전문
    - 토큰 심볼
  </Card>
  <Card title="문의처" icon="envelope">
    **이메일**: shs.block@shinhan.com

    영업일 기준 24시간 이내 답변
  </Card>
</CardGroup>
